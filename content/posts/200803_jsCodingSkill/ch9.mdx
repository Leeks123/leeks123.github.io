---
title: <자바스크립트 코딩의 기술> ch9
date: 2020-08-03
tags:
  - JS
---

### 프라미스를 이용해 비동기적으로 데이터를 가져오라

###### 비동기

이전의 코드가 완전히 해결되지 않아도 이어지는 코드를 실행할 수 있는 언어

###### 프라미스

비동기 작업을 전달바다어서 응당에 따라 두 가지 메서드 중 하나를 호출하는 객체
프라미스는 비동기 작업이 성공하거나 충족된 경우 `then()`메서드에 결과를 넘겨줌
실패하거나 거부된 경우 프라미스가 `catch()`메서드를 호출

프라미스는 두 개의 인수, `resolve()`와 `reject()`를 전달 받음.
`resolve()`는 코드가 의도대로 동작했을 때 실행. `resolve()`가 호출되면 `then()`메서드에 전달된 함수가 실행

```javascript
function getUserPreferences(){
  const preferences = new Promise((resolve, reject) => {
    resolve({
      theme:'dusk',
    });
  });
  return preferences;
}

getUserPreferences()
	.then(preferences => {
  	console.log(preferences.theme);
});
// 'dusk'
```



```javascript
function failUserPreference(){
  const finder = new Promise((resolve,reject) => {
    reject({
      type:'접근 거부됨',
    });
  });
  return finder;
}

failUserPreference()
	.then(preferences => {
  	console.log(preferences.theme);
})
.catch(error => {
  console.error(`실패: ${error.type}`);
});
```

프라미스를 연결하는 경우 `catch()`메서드를 개별적으로 연결할 필요가 없음. 하나만 정의해서 모든 경우 처리 가능


---


### async/await로 함수를 명료하게 생성하라

`async`키워드를 이용해서 선언한 함수는 비동기 데이터를 사용한다는 것을 의미

`await`키워드를 사용하면 값이 반환될 때까지 함수의 실행을 중지시킬 수 있음

```javascript
async function getTheme(){
  const { theme } = await getUserPreferences();
  return theme;
}

getTheme()
	.then(theme => {
  	console.log(theme);
})
```

---

### fetch로 간단한 AJAX 호출을 처리하라

###### GET 요청

데이터를 가져오는 것만 처리한다면 끝점 URL을 인수로 해서 fetch를 호출하면 됨

```javascript
fetch('https://jsonplaceholder.typicode.com/posts/1');
```

```javascript
{
  userId : 1,
  id : 1,
  title : 'First Post',
  body : 'This is my first post ...',
}
```

요청을 보내고 나면 `fetch()`는 응답을 처리하는 프라미스를 반환.
이어서 해야 할 작업은 `then()`메서드에 응답을 처리하는 콜백함수를 추가하는 것

응답 본문이 항상 사용할 수 있는 형식이 아니다. 
다행히 `fetch()`는 다양한 믹스인을 포함하고 있어서 자동으로 변환해줌
`then()` 메서드의 콜백에서 파싱된 데이터를 처리할 수 있음

```javascript
fetch('https://jsonplaceholder.typicode.com/posts/1')
	.then(data => {
  	if(!data.ok){
      throw Error(data.status);
    }
  	return data.json();
})
.then(post => {
  console.log(post.title);
})
.catch(e => {
  console.log(e);
});
```

###### POST 요청

```javascript
const update = {
  title : 'Clarence White Techniques',
  body : 'Amazing',
  userId : 1,
};

const options = {
  method : 'POST',
  headers: {
    'Content-Type':'application/json',
  },
  body : JSON.stringify(update),
};

fetch('https://jsonplaceholder.typicode.com/posts',options)
.then(data => {
  if(!data.ok){
    throw Error(data.status);
  }
  return data.json();
}).then(update => {
  console.log(update);
}).catch(e => {
  console.log(e);
});
```

---

### localStorage로 상태를 장기간 유지하라

###### localStorage에 저장

localStorage 객체에 `setItem()`메서드를 사용해서 값을 설정
첫 번째 인수에는 키, 두 번째 인수에는 값을 전달

###### 데이터 가져오기

```javascript
localStorage.getItem(key);
```



###### 삭제

```javascript
localStorage.removeItem(key);
```



localStorage에 담기는 데이터는 반드시 문자열이어야 함.
`JSON.stringify()`를 이용해 데이터를 문자열로 변환하고,
다시 가져올 때는 `JSON.parse()`를 이용해 변환하면 됨

여러 기기에서 데이터를 유지할 수는 없지만 로그인을 피할 수 있다는 이점